---
title: "Sarnasus diagrammid (_chord diagram_)"
output: 
  html_document:
    theme: null
---

### Sissejuhatus

**Sarnasus diagramm** (_chord diagram_) on maatriks tüüpi (üldiselt sarnasuste aga võib ka kauguste või seoste) andmete graafiline esitusviis. Tunnused esitatakse ringi kujuliselt ja tunnuste vahelised seosed on esitatud kaartena. Üldiselt ringist haaratud osa võib näidata tunnuse osakaalu kõikidest andmetest ja ühendatud kaarte laius seose tugevust. Värvidega on võimalik näidata suunda.

R-is võimaldab pakett `chorddiag` teha interaktiivseid sarnasus diagramme. Pakett kasutab JavaScripti D3 visulisatsiooni teeki. Diagramm väljastatakse R-is html väljundina, seega on R Markdown-ga lihtne haaravaid veebilehti vormistada.

Selles lisapraktikumis uurime sarnasuste esitamist eelmainitud graafiku abil, valmistame ette andmed ja loome interaktiivse joonise. Selle saavutamiseks kasutame R-i `chorddiag` paketti.

### Lihtne näide

Allolev graafik näitab palju põhikooli õpilasi igast klassi paralleelist on valinud omale lisakursuseid. Hiirega kaarte peale minnes kuvatakse sektsiooni ja ainet ühendav kaar ning selle taga peituv number. Näiteks paralleelist A on 50 õpilast soovinud ennast matemaatika rohkem harida ja paralleelist C on 29 õpilast valinud omale lisaõppeaineks füüsika.

Kood ja tulemus

```{r}
library(chorddiag)

opilased = data.frame(Matem = c(50, 25, 5, 12),
                      Kunst = c(10, 55, 5, 20),
                      Fyysika = c(45,12,29, 20),
                      KehalKasv = c(24,67,27,15))

opilased = as.matrix(opilased)
row.names(opilased) = c("Paralleel A", "Paralleel B", "Paralleel C", "Paralleel D")

chorddiag(opilased, 
          type = "bipartite", 
          showTicks = F, 
          groupnameFontsize = 14, 
          groupnamePadding = 10, 
          margin = 90)
```

Graafikut analüüsides võib öelda esmalt, et B paralleel on kõige suurem, järgnevad A, D ja C. Teiseks on B paralleelis suur huvi spordi ja kunstiõpetuse vastu, füüsika ja matemaatika jäävad tahaplaanile. Kõige tasakaalukam lisakursuste osas on D paralleel kuna neil on õppeained kõige ühtlasemalt jaotunud.

### Ülesanne 1 (4 punkti) 

Uuri chorddiag dokumentatsiooni ja vasta järgmistele küsimustele:

* Mida reguleerib argument `showTicks`?
* Proovi lahti seletada, mis muutub graafikul kui argument `type` väärtus muuta `directional`? Mis sorti andmeid soovib funktsioon `chorddiag` kui `type = bipartite` ja milliseid kui `type = directional`?
* Muuda eelmises näites argument `type = directional` ja oletame:
  * Veergudes on ained, mis õpilased valisid esimese poolaasta lisakursuste blokiks ja 
  * ridades on ained, mille hulgast valiti 2. poolaasta lisakursused. 

Tõlgenda 2-3 juhtu joonise põhjal.

```{r}
# sinu kood
```

<!--
### Andmestik




### Ülesanne 2 (3 punkt) -  andmete õigesse vormi viimine

Vii andmed õigesse vormi, tulemuseks peaksid saama maatriksi, kus veergudes on tunnused ja ridades samuti tunnused ning maatriksi sees on mõõdetud sarnasus.

```{r}
# sinu kood
```

### Ülesanne 2 (3 punkti) - sarnasuse diagramm





```{r}
# sinu kood
```







### Ülesanne 3 (4 punkti) - shiny app

Esita eelmises ülesandes leitud joonis shiny rakendusena.

*UI*
```{r, eval = FALSE}
library(shiny)
library(chorddiag)

shinyUI(fluidPage(
  br(),
  br(),
  radioButtons('select_market',"Select Market",inline = TRUE,
               choices = c("East","West","South","North"),
               selected = 'East'),
  
  chorddiagOutput("distPlot", height = 600)
))
```

*server*
```{r, eval = FALSE}
library(shiny)
library(chorddiag)

set.seed(1)   # for reproducibility
df_east = matrix(sample(seq(100, 5000, 50), 49), ncol = 7)
row.names(df_east) = c("Company A" ,"Company B" ,"Company C" ,"Company D","Company E", "Company F" ,"Company G")
colnames(df_east) = row.names(df_east)

set.seed(2)  
df_west = matrix(sample(seq(100, 5000, 50), 49), ncol = 7)
colnames(df_west) = row.names(df_east)
row.names(df_west) = row.names(df_east)


set.seed(3)   
df_south = matrix(sample(seq(100, 5000, 50), 49), ncol = 7)
colnames(df_south) = row.names(df_east)
row.names(df_south) = row.names(df_east)

set.seed(4)  
df_north = matrix(sample(seq(100, 5000, 50), 49), ncol = 7)
colnames(df_north) = row.names(df_east)
row.names(df_north) = row.names(df_east)


shinyServer(function(input, output) {
   

  output$distPlot <- renderChorddiag({
    
       if(input$select_market =="East"){
         chorddiag(df_east, showTicks = F, groupnameFontsize = 14, groupnamePadding = 10, margin = 90)
       }else if(
        input$select_market =="West"){
        chorddiag(df_west, showTicks = F, groupnameFontsize = 14, groupnamePadding = 10, margin = 90)
       } else if(
         input$select_market =="South"){
         chorddiag(df_south, showTicks = F, groupnameFontsize = 14, groupnamePadding = 10, margin = 90)
       }else{
         chorddiag(df_north, showTicks = F, groupnameFontsize = 14, groupnamePadding = 10, margin = 90)
       }
    
  })
  
})
```

### Ülesanne 4 (6 punkti)

Täienda shiny rakendust järgmiselt:
 - lisa raadionuppud "Turu" valikutega: "Ida", "Lääs", "Lõuna"
 - täiusta `server` koodi, nii, et raadionupu valik filtreeriks andmeid ja sarnasuste joonis muutuks.

-->